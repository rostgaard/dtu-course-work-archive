<?xml version="1.0" encoding="UTF-8"?>
<process
    name="travelGood"
    targetNamespace="http://enterprise.netbeans.org/bpel/TravelGood/travelGood"
    xmlns:tns="http://enterprise.netbeans.org/bpel/TravelGood/travelGood"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" xmlns:sxed2="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor2" xmlns:ns0="http://planning.ws" xmlns:ns1="http://lameduck.ws" xmlns:ns="http:/niceview.ws" xmlns:sxxf="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/XPathFunctions">
   <import namespace="http://planning.ws" location="planning.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <import namespace="http://lameduck.ws" location="http://localhost:8080/LameDuck/LameDuckWSDLService?wsdl=1" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <import namespace="http:/niceview.ws" location="http://localhost:8080/NiceViewWSDL/NiceViewWSDLService?wsdl=1" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <partnerLinks>
      <partnerLink name="PartnerLink4" partnerLinkType="ns1:LameDuckWSDL" partnerRole="LameDuckWSDLPortTypeRole"/>
      <partnerLink name="PartnerLink5" partnerLinkType="ns:NiceViewWSDL" partnerRole="NiceViewWSDLPortTypeRole"/>
      <partnerLink name="PartnerLink3" partnerLinkType="ns0:itinerary" myRole="itineraryPortTypeRole"/>
   </partnerLinks>
   <variables>
      <variable name="cancelSucceed" type="xs:boolean"/>
      <variable name="isAllBooked" type="xs:boolean"/>
      <variable name="ed" type="xs:date"/>
      <variable name="flightCounter" type="xs:int"/>
      <variable name="hotelCounter" type="xs:int"/>
      <variable name="listOfHotels" type="ns0:listOfHotels">
         <sxed2:editor>
            <sxed2:predicate path="$listOfHotels/hotelStatus[$hotelCount]" source="to"/>
            <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEachHotelCounter]" source="to"/>
            <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEachHotelCounter]" source="from"/>
         </sxed2:editor>
      </variable>
      <variable name="listOfFlights" type="ns0:listOfFlights">
         <sxed2:editor>
            <sxed2:predicate path="$listOfFlights/flightStatus[$flightCount]" source="to"/>
            <sxed2:predicate path="$listOfFlights/flightStatus[$ForEachFlightCounter]" source="from"/>
            <sxed2:predicate path="$listOfFlights/flightStatus[$listOfFlights/count]" source="to"/>
            <sxed2:predicate path="$listOfFlights/flightStatus[$ForEachFlightCounter]" source="to"/>
         </sxed2:editor>
      </variable>
      <variable name="AddHotelToPlanOut" messageType="ns0:addHotelToPlanResponse"/>
      <variable name="AddHotelToPlanIn" messageType="ns0:addPlannedHotelRequest"/>
      <variable name="GetAvailableHotelsOut" messageType="ns0:getHotelsResponse"/>
      <variable name="GetAvailableHotelsIn" messageType="ns0:getHotelsRequest"/>
      <variable name="AddFlightOut" messageType="ns0:addPlannedFlightResponse"/>
      <variable name="CreateItineraryOut" messageType="ns0:createItineraryResponse"/>
      <variable name="BookAllOut" messageType="ns0:bookAllResponse"/>
      <variable name="GetFlightsOut" messageType="ns0:getAvailableFlightsResponse"/>
      <variable name="BookAllIn" messageType="ns0:bookAllRequest"/>
      <variable name="GetFlightsIn" messageType="ns0:getAvailableFlightsRequest"/>
      <variable name="AddFlightIn" messageType="ns0:addPlannedFlightRequest"/>
      <variable name="CreateItineraryIn" messageType="ns0:createItineraryRequest"/>
      <variable name="isPlanning" type="xs:boolean"/>
   </variables>
   <correlationSets>
      <correlationSet name="ItineraryCorrelation" properties="ns0:ItineraryID ns0:CustomerID"/>
   </correlationSets>
   <sequence name="Sequence1">
      <receive name="ReceiveCreateItinerary" createInstance="yes" partnerLink="PartnerLink3" operation="createItinerary" portType="ns0:itineraryPortType" variable="CreateItineraryIn">
         <correlations>
            <correlation set="ItineraryCorrelation" initiate="yes"/>
         </correlations>
      </receive>
      <assign name="Assign36">
         <copy>
            <from>true()</from>
            <to variable="CreateItineraryOut" part="boolean"/>
         </copy>
      </assign>
      <reply name="ReplyCreateItinerary" partnerLink="PartnerLink3" operation="createItinerary" portType="ns0:itineraryPortType" variable="CreateItineraryOut"/>
      <assign name="Assign1">
         <copy>
            <from>0</from>
            <to>$hotelCounter</to>
         </copy>
         <copy>
            <from>0</from>
            <to>$flightCounter</to>
         </copy>
         <copy>
            <from>true()</from>
            <to variable="cancelSucceed"/>
         </copy>
         <copy>
            <from>sxxf:current-date()</from>
            <to variable="ed"/>
         </copy>
      </assign>
      <scope name="MainScope">
         <variables>
            <variable name="CancelPlanningOperationOut" messageType="ns0:cancelPlanningResponse"/>
            <variable name="CancelPlanningOperationIn" messageType="ns0:cancelPlanningRequest"/>
            <variable name="CancelBookingOperationOut" messageType="ns0:cancelBookingResponse"/>
            <variable name="CancelBookingOperationIn" messageType="ns0:cancelBookingRequest"/>
            <variable name="GetHotelsOut" messageType="ns:GetHotelsResponse"/>
            <variable name="GetHotelsIn" messageType="ns:GetHotelsRequest"/>
            <variable name="GetFlightOut" messageType="ns1:getFlightResponse"/>
            <variable name="GetFlightIn" messageType="ns1:getFlightRequest"/>
         </variables>
         <eventHandlers>
            <onEvent partnerLink="PartnerLink3" operation="getItinerary" portType="ns0:itineraryPortType" variable="eventName" messageType="ns0:getItineraryRequest">
               <correlations>
                  <correlation set="ItineraryCorrelation" initiate="no"/>
               </correlations>
               <scope name="ScopeGetItinerary">
                  <variables>
                     <variable name="GetItineraryOut" messageType="ns0:getItineraryResponse"/>
                  </variables>
                  <sequence name="Sequence10">
                     <assign name="Assign17">
                        <copy>
                           <from variable="listOfFlights"/>
                           <to variable="GetItineraryOut" part="listOfFlights"/>
                        </copy>
                        <copy>
                           <from variable="listOfHotels"/>
                           <to variable="GetItineraryOut" part="listOfHotels"/>
                        </copy>
                     </assign>
                     <reply name="Reply8" partnerLink="PartnerLink3" operation="getItinerary" portType="ns0:itineraryPortType" variable="GetItineraryOut"></reply>
                  </sequence>
               </scope>
            </onEvent>
         </eventHandlers>
         <sequence name="Sequence9">
            <while name="WhileMain">
               <condition>$cancelSucceed</condition>
               <sequence name="Sequence18">
                  <assign name="Assign35">
                     <copy>
                        <from>true()</from>
                        <to variable="isPlanning"/>
                     </copy>
                  </assign>
                  <while name="PlanningWhile">
                     <condition>$isPlanning</condition>
                        <pick name="PickPlanning">
                        <onMessage partnerLink="PartnerLink3" operation="addPlannedFlight" portType="ns0:itineraryPortType" variable="AddFlightIn">
                              <correlations>
                                    <correlation set="ItineraryCorrelation" initiate="no"/>
                                 </correlations>
                                 <sequence name="Sequence2">
                                    <assign name="Assign3">
                                          <copy>
                                                <from>$flightCounter + 1</from>
                                                   <to>$flightCounter</to>
                                             </copy>
                                       </assign>
                                       <assign name="Assign7">
                                          <copy>
                                                <from variable="AddFlightIn" part="flightInfo"/>
                                                   <to>$listOfFlights/flightStatus[$flightCounter]/flightInformation
                                          <sxed2:editor>
                                                            <sxed2:predicate path="$listOfFlights/flightStatus[$$flightCounter]" source="to"/>
                                                         </sxed2:editor>
                                                   </to>
                                             </copy>
                                             <copy>
                                                <from>'Unconfirmed'</from>
                                                   <to>$listOfFlights/flightStatus[$flightCounter]/status
                                          <sxed2:editor>
                                                            <sxed2:predicate path="$listOfFlights/flightStatus[$flightCounter]" source="to"/>
                                                         </sxed2:editor>
                                                   </to>
                                             </copy>
                                          <copy>
                                             <from>true()</from>
                                             <to variable="AddFlightOut" part="status"/>
                                          </copy>
                                       </assign>
                                       <reply name="ReplyAddPlannedFlight" partnerLink="PartnerLink3" operation="addPlannedFlight" portType="ns0:itineraryPortType" variable="AddFlightOut"/>
                                 </sequence>
                           </onMessage>
                           <onMessage partnerLink="PartnerLink3" operation="getAvailableFlights" portType="ns0:itineraryPortType" variable="GetFlightsIn">
                              <correlations>
                                    <correlation set="ItineraryCorrelation" initiate="no"/>
                                 </correlations>
                                 <sequence name="Sequence3">
                                    <assign name="Assign6">
                                          <copy>
                                                <from variable="GetFlightsIn" part="startAirport"/>
                                                   <to variable="GetFlightIn" part="startAirport"/>
                                             </copy>
                                             <copy>
                                                <from variable="GetFlightsIn" part="destinationAirport"/>
                                                   <to variable="GetFlightIn" part="destinationAirport"/>
                                             </copy>
                                             <copy>
                                                <from variable="GetFlightsIn" part="date"/>
                                                   <to variable="GetFlightIn" part="date"/>
                                             </copy>
                                       </assign>
                                       <invoke name="Invoke1" partnerLink="PartnerLink4" operation="getFlight" portType="ns1:LameDuckWSDLPortType" inputVariable="GetFlightIn" outputVariable="GetFlightOut"/>
                                       <assign name="Assign4">
                                          <copy>
                                                <from variable="GetFlightOut" part="flightInformations"/>
                                                   <to variable="GetFlightsOut" part="flights"/>
                                             </copy>
                                       </assign>
                                       <reply name="ReplyGetAvailableFlights" partnerLink="PartnerLink3" operation="getAvailableFlights" portType="ns0:itineraryPortType" variable="GetFlightsOut"/>
                                 </sequence>
                           </onMessage>
                           <onMessage partnerLink="PartnerLink3" operation="addPlannedHotel" portType="ns0:itineraryPortType" variable="AddHotelToPlanIn">
                              <correlations>
                                    <correlation set="ItineraryCorrelation" initiate="no"/>
                                 </correlations>
                                 <sequence name="Sequence5">
                                    <assign name="Assign12">
                                          <copy>
                                                <from>$hotelCounter + 1</from>
                                                   <to>$hotelCounter</to>
                                             </copy>
                                       </assign>
                                       <assign name="Assign11">
                                          <copy>
                                                <from>'Unconfirmed'</from>
                                                   <to>$listOfHotels/hotelStatus[$hotelCounter]/status
                                       <sxed2:editor>
                                                            <sxed2:predicate path="$listOfHotels/hotelStatus[$hotelCounter]" source="to"/>
                                                         </sxed2:editor>
                                                   </to>
                                             </copy>
                                             <copy>
                                                <from variable="AddHotelToPlanIn" part="hotel"/>
                                                   <to>$listOfHotels/hotelStatus[$hotelCounter]/hotel</to>
                                             </copy>
                                          <copy>
                                             <from>true()</from>
                                             <to variable="AddHotelToPlanOut" part="status"/>
                                          </copy>
                                       </assign>
                                       <reply name="ReplyAddPlannedHotel" partnerLink="PartnerLink3" operation="addPlannedHotel" portType="ns0:itineraryPortType" variable="AddHotelToPlanOut"/>
                                 </sequence>
                           </onMessage>
                           <onMessage partnerLink="PartnerLink3" operation="getAvailableHotels" portType="ns0:itineraryPortType" variable="GetAvailableHotelsIn">
                              <correlations>
                                    <correlation set="ItineraryCorrelation" initiate="no"/>
                                 </correlations>
                                 <sequence name="Sequence4">
                                    <assign name="Assign10">
                                          <copy>
                                                <from variable="GetAvailableHotelsIn" part="city"/>
                                                   <to variable="GetHotelsIn" part="city"/>
                                             </copy>
                                             <copy>
                                                <from variable="GetAvailableHotelsIn" part="departureDate"/>
                                                   <to variable="GetHotelsIn" part="departure"/>
                                             </copy>
                                             <copy>
                                                <from variable="GetAvailableHotelsIn" part="arivalDate"/>
                                                   <to variable="GetHotelsIn" part="arrival"/>
                                             </copy>
                                       </assign>
                                       <invoke name="Invoke2" partnerLink="PartnerLink5" operation="getHotels" portType="ns:NiceViewWSDLPortType" inputVariable="GetHotelsIn" outputVariable="GetHotelsOut"/>
                                       <assign name="Assign9">
                                          <copy>
                                                <from variable="GetHotelsOut" part="hotels"/>
                                                   <to variable="GetAvailableHotelsOut" part="hotels"/>
                                             </copy>
                                       </assign>
                                       <reply name="ReplyGetAvailableHotels" partnerLink="PartnerLink3" operation="getAvailableHotels" portType="ns0:itineraryPortType" variable="GetAvailableHotelsOut"/>
                                 </sequence>
                           </onMessage>
                           <onMessage partnerLink="PartnerLink3" operation="bookAll" portType="ns0:itineraryPortType" variable="BookAllIn">
                              <correlations>
                                    <correlation set="ItineraryCorrelation" initiate="no"/>
                                 </correlations>
                                 <assign name="Assign2">
                                    <copy>
                                          <from>false()</from>
                                             <to variable="isPlanning"/>
                                       </copy>
                                 </assign>
                           </onMessage>
                           <onMessage partnerLink="PartnerLink3" operation="cancelPlanningOperation" portType="ns0:itineraryPortType" variable="CancelPlanningOperationIn">
                              <correlations>
                                    <correlation set="ItineraryCorrelation" initiate="no"/>
                                 </correlations>
                                 <sequence name="Sequence6">
                                    <assign name="Assign25">
                                          <copy>
                                                <from>true()</from>
                                                   <to variable="CancelPlanningOperationOut" part="status"/>
                                             </copy>
                                       </assign>
                                       <reply name="ReplyCancelPlanning" partnerLink="PartnerLink3" operation="cancelPlanningOperation" portType="ns0:itineraryPortType" variable="CancelPlanningOperationOut"/>
                                       <exit name="Exit1"/>
                                 </sequence>
                           </onMessage>
                     </pick>
                  </while>
                  <assign name="Assign27">
                     <copy>
                        <from>true()</from>
                        <to variable="isAllBooked"/>
                     </copy>
                  </assign>
                  <scope name="ScopeBook">
                     <faultHandlers>
                        <catchAll>
                              <sequence name="Sequence19">
                                 <assign name="Assign28">
                                    <copy>
                                       <from>false()</from>
                                       <to variable="isAllBooked"/>
                                    </copy>
                                 </assign>
                                 <compensate name="Compensate1"/>
                              </sequence>
                           </catchAll>
                        </faultHandlers>
                        <sequence name="Sequence14">
                           <flow name="FlowBook">
                                 <forEach name="ForEachHotel" parallel="no" counterName="ForEachHotelCounter">
                                       <startCounterValue>1</startCounterValue>
                                          <finalCounterValue>$hotelCounter</finalCounterValue>
                                          <scope name="ScopeBookHotel">
                                             <variables>
                                                   <variable name="CancelHotelOut" messageType="ns:CancelResponse"/>
                                                      <variable name="CancelHotelIn" messageType="ns:CancelRequest"/>
                                                      <variable name="BookHotelOut" messageType="ns:BookResponse"/>
                                                      <variable name="BookHotelIn" messageType="ns:BookRequest"/>
                                                </variables>
                                                <compensationHandler>
                                                   <sequence name="Sequence12">
                                                      <scope name="ScopeCancelHotel">
                                                         <faultHandlers>
                                                            <catchAll>
                                                               <assign name="Assign31">
                                                                  <copy>
                                                                     <from>false()</from>
                                                                     <to variable="cancelSucceed"/>
                                                                  </copy>
                                                               </assign>
                                                            </catchAll>
                                                         </faultHandlers>
                                                         <sequence name="Sequence21">
                                                            <assign name="Assign19">
                                                               <copy>
                                                                  <from>$listOfHotels/hotelStatus[$ForEachHotelCounter]/hotel/bookingNumber
                                                                     <sxed2:editor>
                                                                        <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEachHotelCounter]" source="from"/>
                                                                     </sxed2:editor>
                                                                  </from>
                                                                  <to variable="CancelHotelIn" part="bookingNumber"/>
                                                               </copy>
                                                            </assign>
                                                            <invoke name="Invoke6" partnerLink="PartnerLink5" operation="cancelHotel" portType="ns:NiceViewWSDLPortType" inputVariable="CancelHotelIn" outputVariable="CancelHotelOut"/>
                                                            <assign name="Assign29">
                                                               <copy>
                                                                  <from>'Cancelled'</from>
                                                                  <to>$listOfHotels/hotelStatus[$ForEachHotelCounter]/status
                                                                     <sxed2:editor>
                                                                        <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEachHotelCounter]" source="to"/>
                                                                     </sxed2:editor>
                                                                  </to>
                                                               </copy>
                                                            </assign>
                                                         </sequence>
                                                      </scope>
                                                      </sequence>
                                                </compensationHandler>
                                                <sequence name="Sequence8">
                                                   <assign name="Assign14">
                                                            <copy>
                                                               <from variable="BookAllIn" part="creditCardInfo"/>
                                                                  <to variable="BookHotelIn" part="creditInfo"/>
                                                            </copy>
                                                      <copy>
                                                         <from>$listOfHotels/hotelStatus[$ForEachHotelCounter]/hotel/bookingNumber
                                                            <sxed2:editor>
                                                               <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEachHotelCounter]" source="from"/>
                                                            </sxed2:editor>
                                                         </from>
                                                         <to variable="BookHotelIn" part="bookingNumber"/>
                                                      </copy>
                                                   </assign>
                                                      <invoke name="Invoke4" partnerLink="PartnerLink5" operation="bookHotel" portType="ns:NiceViewWSDLPortType" inputVariable="BookHotelIn" outputVariable="BookHotelOut"/>
                                                      <assign name="Assign15">
                                                         <copy>
                                                               <from>'Confirmed'</from>
                                                                  <to>$listOfHotels/hotelStatus[$ForEachHotelCounter]/status
                                                   <sxed2:editor>
                                                                           <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEachHotelCounter]" source="to"/>
                                                                        </sxed2:editor>
                                                                  </to>
                                                            </copy>
                                                      </assign>
                                                </sequence>
                                          </scope>
                                    </forEach>
                                    <forEach name="ForEachFlight" parallel="no" counterName="ForEachFlightCounter">
                                       <startCounterValue>1</startCounterValue>
                                          <finalCounterValue>$flightCounter</finalCounterValue>
                                          <scope name="ScopeBookFlight">
                                             <variables>
                                                   <variable name="CancelFlightOut" messageType="ns1:cancelFlightResponse"/>
                                                      <variable name="CancelFlightIn" messageType="ns1:cancelFlightRequest"/>
                                                      <variable name="BookFlightOut" messageType="ns1:bookFlightResponse"/>
                                                      <variable name="BookFlightIn" messageType="ns1:bookFlightRequest"/>
                                                </variables>
                                                <compensationHandler>
                                                   <sequence name="Sequence13">
                                                      <scope name="ScopeCancelFlight">
                                                         <faultHandlers>
                                                            <catchAll>
                                                               <assign name="Assign32">
                                                                  <copy>
                                                                     <from>false()</from>
                                                                     <to variable="cancelSucceed"/>
                                                                  </copy>
                                                               </assign>
                                                            </catchAll>
                                                         </faultHandlers>
                                                         <sequence name="Sequence22">
                                                            <assign name="Assign20">
                                                               <copy>
                                                                  <from variable="BookAllIn" part="creditCardInfo"/>
                                                                     <to variable="CancelFlightIn" part="creditCardInformation"/>
                                                               </copy>
                                                                  <copy>
                                                                  <from>$listOfFlights/flightStatus[$ForEachFlightCounter]/flightInformation/bookingNumber
                                       <sxed2:editor>
                                                                              <sxed2:predicate path="$listOfFlights/flightStatus[$ForEachFlightCounter]" source="from"/>
                                                                           </sxed2:editor>
                                                                     </from>
                                                                     <to variable="CancelFlightIn" part="bookingNumber"/>
                                                               </copy>
                                                                  <copy>
                                                                  <from>$listOfFlights/flightStatus[$ForEachFlightCounter]/flightInformation/price + 0
                                                            <sxed2:editor>
                                                                              <sxed2:predicate path="$listOfFlights/flightStatus[$ForEachFlightCounter]" source="from"/>
                                                                           </sxed2:editor>
                                                                     </from>
                                                                     <to variable="CancelFlightIn" part="price"/>
                                                               </copy>
                                                            </assign>
                                                            <invoke name="Invoke7" partnerLink="PartnerLink4" operation="cancelFlight" portType="ns1:LameDuckWSDLPortType" inputVariable="CancelFlightIn" outputVariable="CancelFlightOut"/>
                                                            <assign name="Assign30">
                                                               <copy>
                                                                  <from>'Cancelled'</from>
                                                                  <to>$listOfFlights/flightStatus[$ForEachFlightCounter]/status
                                                                     <sxed2:editor>
                                                                        <sxed2:predicate path="$listOfFlights/flightStatus[$ForEachFlightCounter]" source="to"/>
                                                                     </sxed2:editor>
                                                                  </to>
                                                               </copy>
                                                            </assign>
                                                         </sequence>
                                                      </scope>
                                                      </sequence>
                                                </compensationHandler>
                                                <sequence name="Sequence7">
                                                   <assign name="Assign13">
                                                         <copy>
                                                               <from variable="BookAllIn" part="creditCardInfo"/>
                                                                  <to variable="BookFlightIn" part="creditCardInformation"/>
                                                            </copy>
                                                            <copy>
                                                               <from>$listOfFlights/flightStatus[$ForEachFlightCounter]/flightInformation/bookingNumber
                           <sxed2:editor>
                                                                           <sxed2:predicate path="$listOfFlights/flightStatus[$ForEachFlightCounter]" source="from"/>
                                                                        </sxed2:editor>
                                                                  </from>
                                                                  <to variable="BookFlightIn" part="bookingNumber"/>
                                                            </copy>
                                                      </assign>
                                                      <invoke name="Invoke3" partnerLink="PartnerLink4" operation="bookFlight" portType="ns1:LameDuckWSDLPortType" inputVariable="BookFlightIn" outputVariable="BookFlightOut"/>
                                                      <assign name="Assign16">
                                                         <copy>
                                                               <from>'Confirmed'</from>
                                                                  <to>$listOfFlights/flightStatus[$ForEachFlightCounter]/status
                                             <sxed2:editor>
                                                                           <sxed2:predicate path="$listOfFlights/flightStatus[$ForEachFlightCounter]" source="to"/>
                                                                        </sxed2:editor>
                                                                  </to>
                                                            </copy>
                                                      </assign>
                                                </sequence>
                                          </scope>
                                    </forEach>
                              </flow>
                        </sequence>
                  </scope>
                  <assign name="Assign5">
                     <copy>
                        <from variable="isAllBooked"/>
                        <to variable="BookAllOut" part="status"/>
                     </copy>
                  </assign>
                  <reply name="ReplyBook" partnerLink="PartnerLink3" operation="bookAll" portType="ns0:itineraryPortType" variable="BookAllOut"></reply>
                  <if name="IfBookSucceeded">
                     <condition>$isAllBooked</condition>
                     <sequence name="Sequence20">
                        <pick name="PickCancel">
                           <onMessage partnerLink="PartnerLink3" operation="cancelBookingOperation" portType="ns0:itineraryPortType" variable="CancelBookingOperationIn">
                              <correlations>
                                 <correlation set="ItineraryCorrelation" initiate="no"/>
                              </correlations>
                              <flow name="FlowCancel">
                                 <forEach name="ForEachHotel" parallel="no" counterName="ForEachHotelCounter">
                                       <startCounterValue>1</startCounterValue>
                                          <finalCounterValue>$hotelCounter</finalCounterValue>
                                          <scope name="ScopeCancelHotel">
                                             <variables>
                                                   <variable name="CancelHotelOut" messageType="ns:CancelResponse"/>
                                                      <variable name="CancelHotelIn" messageType="ns:CancelRequest"/>
                                                </variables>
                                                <faultHandlers>
                                                   <catchAll>
                                                         <assign name="Assign33">
                                                               <copy>
                                                                     <from>false()</from>
                                                                        <to variable="cancelSucceed"/>
                                                                  </copy>
                                                            </assign>
                                                      </catchAll>
                                                </faultHandlers>
                                                <sequence name="Sequence16">
                                                   <assign name="Assign21">
                                                      <copy>
                                                         <from>$listOfHotels/hotelStatus[$ForEachHotelCounter]/hotel/bookingNumber
                                                            <sxed2:editor>
                                                               <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEach1Counter]" source="from"/>
                                                            </sxed2:editor>
                                                         </from>
                                                         <to variable="CancelHotelIn" part="bookingNumber"/>
                                                      </copy>
                                                   </assign>
                                                      <invoke name="Invoke8" partnerLink="PartnerLink5" operation="cancelHotel" portType="ns:NiceViewWSDLPortType" inputVariable="CancelHotelIn" outputVariable="CancelHotelOut"/>
                                                      <assign name="Assign23">
                                                         <copy>
                                                               <from>'Cancelled'</from>
                                                                  <to>$listOfHotels/hotelStatus[$ForEachHotelCounter]/status
                                             <sxed2:editor>
                                                                           <sxed2:predicate path="$listOfHotels/hotelStatus[$ForEach1Counter]" source="to"/>
                                                                        </sxed2:editor>
                                                                  </to>
                                                            </copy>
                                                      </assign>
                                                </sequence>
                                          </scope>
                                    </forEach>
                                    <forEach name="ForEachFlight" parallel="no" counterName="ForEachFlightCounter">
                                       <startCounterValue>1</startCounterValue>
                                          <finalCounterValue>$flightCounter</finalCounterValue>
                                          <scope name="ScopeCancelFlight">
                                             <variables>
                                                   <variable name="CancelFlightOut" messageType="ns1:cancelFlightResponse"/>
                                                      <variable name="CancelFlightIn" messageType="ns1:cancelFlightRequest"/>
                                                </variables>
                                                <faultHandlers>
                                                   <catchAll>
                                                         <assign name="Assign34">
                                                               <copy>
                                                                     <from>false()</from>
                                                                        <to variable="cancelSucceed"/>
                                                                  </copy>
                                                            </assign>
                                                      </catchAll>
                                                </faultHandlers>
                                                <sequence name="Sequence17">
                                                   <assign name="Assign22">
                                                         <copy>
                                                               <from>$listOfFlights/flightStatus[$ForEachFlightCounter]/flightInformation/bookingNumber
                                             <sxed2:editor>
                                                                           <sxed2:predicate path="$listOfFlights/flightStatus[$ForEach2Counter]" source="from"/>
                                                                        </sxed2:editor>
                                                                  </from>
                                                                  <to variable="CancelFlightIn" part="bookingNumber"/>
                                                            </copy>
                                                            <copy>
                                                               <from>$listOfFlights/flightStatus[$ForEachFlightCounter]/flightInformation/price + 0
                                             <sxed2:editor>
                                                                           <sxed2:predicate path="$listOfFlights/flightStatus[$ForEach2Counter]" source="from"/>
                                                                        </sxed2:editor>
                                                                  </from>
                                                                  <to variable="CancelFlightIn" part="price"/>
                                                            </copy>
                                                            <copy>
                                                               <from variable="BookAllIn" part="creditCardInfo"/>
                                                                  <to variable="CancelFlightIn" part="creditCardInformation"/>
                                                            </copy>
                                                      </assign>
                                                      <invoke name="Invoke9" partnerLink="PartnerLink4" operation="cancelFlight" portType="ns1:LameDuckWSDLPortType" inputVariable="CancelFlightIn" outputVariable="CancelFlightOut"/>
                                                      <assign name="Assign24">
                                                         <copy>
                                                               <from>'Cancelled'</from>
                                                                  <to>$listOfFlights/flightStatus[$ForEachFlightCounter]/status
                                             <sxed2:editor>
                                                                           <sxed2:predicate path="$listOfFlights/flightStatus[$ForEach2Counter]" source="to"/>
                                                                        </sxed2:editor>
                                                                  </to>
                                                            </copy>
                                                      </assign>
                                                </sequence>
                                          </scope>
                                    </forEach>
                              </flow>
                           </onMessage>
                           <onAlarm>
                              <for>'P0Y0M0DT0H0M15.0S'</for>
                              <exit name="Exit2"/>
                           </onAlarm>
                        </pick>
                        <assign name="Assign26">
                           <copy>
                              <from variable="cancelSucceed"/>
                              <to variable="CancelBookingOperationOut" part="status"/>
                           </copy>
                        </assign>
                        <reply name="ReplyCancelBook" partnerLink="PartnerLink3" operation="cancelBookingOperation" portType="ns0:itineraryPortType" variable="CancelBookingOperationOut"/>
                     </sequence>
                  </if>
               </sequence>
            </while>
            <wait name="Wait1">
               <for>'P0Y0M0DT0H0M15.0S'</for>
            </wait>
         </sequence>
      </scope>
   </sequence>
</process>






