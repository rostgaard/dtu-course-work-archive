<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>02333 Task 1: src/kernel.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>src/kernel.h</h1><a href="kernel_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*! \file kernel.h</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment"> This file holds kernel wide macros and declarations.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#ifndef _KERNEL_H_</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#define _KERNEL_H_</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="comment">/* Type definitions */</span>
<a name="l00011"></a><a class="code" href="kernel_8h.html#2b7e7856b48ec3327148ac994ad95cd5">00011</a> <span class="keyword">typedef</span> <span class="keywordtype">char</span> <a class="code" href="kernel_8h.html#2b7e7856b48ec3327148ac994ad95cd5">byte</a>;
<a name="l00012"></a>00012 <span class="comment">/* Macros */</span>
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="kernel_8h.html#6575dcab992f58c103eca3bb0c4e8cb3">00014</a> <span class="preprocessor">#define SYSCALL_ARGUMENTS (((struct context) saved_registers).integer_registers)</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="comment">/*!&lt; Macro used in the system call switch to access the arguments to the </span>
<a name="l00016"></a>00016 <span class="comment">     system call. */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="kernel_8h.html#02a011ae232d9bd03776f3a57d95cf89">00018</a> <span class="preprocessor">#define KERNEL_VERSION        (0x0000000100000000)</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="comment">/*!&lt; Kernel version number. */</span>
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="kernel_8h.html#e34bccefcb5925f2ccd27bc3a0b4731d">00021</a> <span class="preprocessor">#define ALL_OK                (0)</span>
<a name="l00022"></a><a class="code" href="kernel_8h.html#8fe83ac76edc595f6b98cd4a4127aed5">00022</a> <span class="preprocessor"></span><span class="preprocessor">#define ERROR                 (-1)</span>
<a name="l00023"></a><a class="code" href="kernel_8h.html#18431da9f3fd1f6c3a78cd1e68461311">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define ERROR_ILLEGAL_SYSCALL (-2)</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="kernel_8h.html#4f986800d7cfc1d354d541b442ed2d8c">00025</a> <span class="preprocessor">#define SYSCALL_VERSION       (0)</span>
<a name="l00026"></a><a class="code" href="kernel_8h.html#d4912509049f4293f615cbfd91c3d2ee">00026</a> <span class="preprocessor"></span><span class="preprocessor">#define SYSCALL_PRINTS        (1)</span>
<a name="l00027"></a><a class="code" href="kernel_8h.html#deb75659e0a332dea8b94f5fe6c3e1c7">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define SYSCALL_PRINTHEX      (2)</span>
<a name="l00028"></a><a class="code" href="kernel_8h.html#6b17dc33bdf7c13954ae4053ff6d2037">00028</a> <span class="preprocessor"></span><span class="preprocessor">#define SYSCALL_DEBUGGER      (3)</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="comment">/* Type declarations */</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">/*! Defines an execution context. */</span>
<a name="l00033"></a><a class="code" href="structcontext.html">00033</a> <span class="keyword">struct </span><a class="code" href="structcontext.html" title="Defines an execution context.">context</a>
<a name="l00034"></a>00034 {
<a name="l00035"></a>00035  <a class="code" href="kernel_8h.html#2b7e7856b48ec3327148ac994ad95cd5">byte</a>     <a class="code" href="structcontext.html#0e63ed3f8f5723579451aac6c30d1505" title="Stores the fpu/mmx/sse registers.">fpu_context</a>[512];<span class="comment"></span>
<a name="l00036"></a><a class="code" href="structcontext.html#0e63ed3f8f5723579451aac6c30d1505">00036</a> <span class="comment"> /*!&lt; Stores the fpu/mmx/sse registers */</span>
<a name="l00037"></a>00037  <span class="keyword">struct</span>
<a name="l00038"></a>00038  {
<a name="l00039"></a><a class="code" href="structcontext.html#24aa932cc08c8f090974663aee8cb590">00039</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#24aa932cc08c8f090974663aee8cb590">rax</a>;
<a name="l00040"></a><a class="code" href="structcontext.html#d14dea947daaa47a6448eda2b815e88b">00040</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#d14dea947daaa47a6448eda2b815e88b">rbx</a>;
<a name="l00041"></a><a class="code" href="structcontext.html#a60aec8b6a9d05e94f985195696b3a68">00041</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#a60aec8b6a9d05e94f985195696b3a68">rcx</a>;
<a name="l00042"></a><a class="code" href="structcontext.html#067b080e9e416b6ed41e707f7f1cfb8d">00042</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#067b080e9e416b6ed41e707f7f1cfb8d">rdx</a>;
<a name="l00043"></a><a class="code" href="structcontext.html#68a2a19852e813ddfbb082bcf77a455c">00043</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#68a2a19852e813ddfbb082bcf77a455c" title="destination index for string operations">rdi</a>;          <span class="comment">/*!&lt; destination index for string operations */</span>
<a name="l00044"></a><a class="code" href="structcontext.html#64d66224d8b305184b07eb06dc60f134">00044</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#64d66224d8b305184b07eb06dc60f134" title="source index for string operations">rsi</a>;          <span class="comment">/*!&lt; source index for string operations */</span>
<a name="l00045"></a><a class="code" href="structcontext.html#16f4817d6c0c73ee4c0cdb5aaad595fc">00045</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#16f4817d6c0c73ee4c0cdb5aaad595fc" title="stack base pointer for current stack frame">rbp</a>;          <span class="comment">/*!&lt; stack base pointer for current stack frame */</span>
<a name="l00046"></a><a class="code" href="structcontext.html#b1221726a300db413f0a06ab73fe2a5c">00046</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#b1221726a300db413f0a06ab73fe2a5c" title="stack pointer">rsp</a>;          <span class="comment">/*!&lt; stack pointer */</span>
<a name="l00047"></a><a class="code" href="structcontext.html#b6a97c443ac6b824f53ca3a91ee4b422">00047</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#b6a97c443ac6b824f53ca3a91ee4b422">r8</a>;
<a name="l00048"></a><a class="code" href="structcontext.html#e1f4b26b1fd22fe0a2faf7900e768441">00048</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#e1f4b26b1fd22fe0a2faf7900e768441">r9</a>;
<a name="l00049"></a><a class="code" href="structcontext.html#a1a0a0545765163f058aa6ed84015b7e">00049</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#a1a0a0545765163f058aa6ed84015b7e">r10</a>;
<a name="l00050"></a><a class="code" href="structcontext.html#7536d17fedcd4fb2be991575caf9c4e9">00050</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#7536d17fedcd4fb2be991575caf9c4e9">r11</a>;
<a name="l00051"></a><a class="code" href="structcontext.html#d4afb08136bc101b79f63c08d9cef21a">00051</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#d4afb08136bc101b79f63c08d9cef21a">r12</a>;
<a name="l00052"></a><a class="code" href="structcontext.html#5775261579e35bdd6d2b5f3f434145e3">00052</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#5775261579e35bdd6d2b5f3f434145e3">r13</a>;
<a name="l00053"></a><a class="code" href="structcontext.html#80c7444135d9be8047261cd404324d10">00053</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#80c7444135d9be8047261cd404324d10">r14</a>;
<a name="l00054"></a><a class="code" href="structcontext.html#0c1aa3d6077a5e1f1fa6b67ba2fb64bf">00054</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#0c1aa3d6077a5e1f1fa6b67ba2fb64bf">r15</a>;
<a name="l00055"></a><a class="code" href="structcontext.html#b7dcdaab21ef5db05aa8f2bf67c9a025">00055</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#b7dcdaab21ef5db05aa8f2bf67c9a025" title="status flags">rflags</a>;       <span class="comment">/*!&lt; status flags */</span>
<a name="l00056"></a><a class="code" href="structcontext.html#63fbab25a27461e7fe08f091d8c7fcea">00056</a>   <span class="keywordtype">long</span>    <a class="code" href="structcontext.html#63fbab25a27461e7fe08f091d8c7fcea" title="instruction pointer">rip</a>;          <span class="comment">/*!&lt; instruction pointer */</span>
<a name="l00057"></a>00057  }        <a class="code" href="structcontext.html#2231e85bf6127f1385722ff6152f8229" title="Stores all user visible integer registers.">integer_registers</a>;<span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment"> /*!&lt; Stores all user visible integer registers. The segment registers are not</span>
<a name="l00059"></a>00059 <span class="comment">      stored as the user mode processes can only use a code and a data segment</span>
<a name="l00060"></a>00060 <span class="comment">      descriptor. We assume that the cs is set to the code and all the rest</span>
<a name="l00061"></a>00061 <span class="comment">      of the segment registers are set to the data segment all the time. */</span>
<a name="l00062"></a>00062 };
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">/* Variable declarations */</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structcontext.html" title="Defines an execution context.">context</a>
<a name="l00067"></a>00067 <a class="code" href="kernel_8c.html#f13c9f9c98cafcef539668f1912cdcd7" title="Stores the callee&amp;#39;s registers during a system call.">saved_registers</a>;<span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">/*!&lt; Stores the callee's registers during a system call. */</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">/* Function declarations */</span>
<a name="l00071"></a>00071 <span class="comment"></span>
<a name="l00072"></a>00072 <span class="comment">/*! This function initializes the kernel after the assembly code portion has</span>
<a name="l00073"></a>00073 <span class="comment">    set the system and the CPU up. */</span>
<a name="l00074"></a>00074 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l00075"></a>00075 <a class="code" href="kernel_8c.html#9efe22aaead3a5e936b5df459de02eba" title="This function initializes the kernel after the assembly code portion has set the...">initialize</a>(<span class="keywordtype">void</span>);
<a name="l00076"></a>00076 <span class="comment"></span>
<a name="l00077"></a>00077 <span class="comment">/*! This function gets called from the system call handler and responds to the</span>
<a name="l00078"></a>00078 <span class="comment">    system calls. */</span>
<a name="l00079"></a>00079 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l00080"></a>00080 <a class="code" href="kernel_8h.html#c0e4400bb0e7b600b2670d5a68c15c7b" title="This function gets called from the system call handler and responds to the system...">system_call_handler</a>(<span class="keywordtype">void</span>);
<a name="l00081"></a>00081 <span class="comment"></span>
<a name="l00082"></a>00082 <span class="comment">/*! Outputs a string to the bochs console. */</span>
<a name="l00083"></a>00083 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l00084"></a>00084 <a class="code" href="kernel_8c.html#76038da662be0fc9b74ae3c5210f2456" title="Outputs a string to the bochs console.">kprints</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> <span class="keywordtype">string</span><span class="comment"></span>
<a name="l00085"></a>00085 <span class="comment">        /*!&lt; points to a null terminated string */</span>
<a name="l00086"></a>00086         );
<a name="l00087"></a>00087 <span class="comment"></span>
<a name="l00088"></a>00088 <span class="comment">/*! Prints a long formatted as a hexadecimal number to the bochs console. */</span>
<a name="l00089"></a>00089 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l00090"></a>00090 <a class="code" href="kernel_8c.html#43a7639c869aabcbadfa32e21cd270c0" title="Prints a long formatted as a hexadecimal number to the bochs console.">kprinthex</a>(<span class="keyword">const</span> <span class="keyword">register</span> <span class="keywordtype">long</span> value<span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">          /*!&lt; the value to be written */</span>);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Aug 31 22:00:25 2008 for 02333 Task 1 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
